# ๐ฑ ุฏููู ุชุทุจูู ูููู ููุฏุนูุงุช - Lony Invitations System

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ
ุชุทุจูู ููุจ ูุชูุงูู ูุฅุฏุงุฑุฉ ุงูุฏุนูุงุช ูุงูุถููู ูุน ูุงุณุญ ุถูุฆู ูููุงุชู ุงููุญููู (PWA)

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู (Data Flow)

### 1๏ธโฃ **ุฅูุดุงุก ุญุฏุซ ุฌุฏูุฏ**
```
ุตูุญุฉ: EventManager.tsx
โ
ุงูุจูุงูุงุช ุงูููุฏุฎูุฉ:
- ุงุณู ุงูุญุฏุซ
- ุงูุชุงุฑูุฎ
- ุงูููุงู
โ
ุญูุธ ูู: events table
```

### 2๏ธโฃ **ุฑูุน ูุงุฆูุฉ ุงูุถููู (Excel)**
```
ุตูุญุฉ: UploadGuests.tsx
โ
ุชุญููู ุงูููู ุจูุงุณุทุฉ AI (Gemini):
- ุงุณุชุฎุฑุงุฌ ุงูุฃุนูุฏุฉ (name, phone, table)
- ุงูุชุฑุงุญ ุงููุทุงุจูุฉ ุงูุฐููุฉ
โ
ุญูุธ ูู: guests table
  - name: ุงุณู ุงูุถูู
  - phone: ุฑูู ุงููุงุชู
  - serial: ุฑูู ุชุณูุณูู ูุฑูุฏ
  - qr_payload: ูุต ุงูุจุงุฑููุฏ (UUID)
  - custom_data: ุฌููุน ุงูุฃุนูุฏุฉ ุงูุฅุถุงููุฉ (JSONB)
  - status: 'pending' (ุงูุญุงูุฉ ุงูุงูุชุฑุงุถูุฉ)
```

### 3๏ธโฃ **ุชุตููู ุงูุฏุนูุฉ**
```
ุตูุญุฉ: GenerateInvitations.tsx + CanvasEditor.tsx
โ
1. ุฑูุน ุตูุฑุฉ ุงูุชุตููู ุงููุงุฑุบุฉ
2. ุฅุถุงูุฉ ุญููู ุฏููุงููููุฉ:
   - ุงุณู ุงูุถูู [name]
   - ุงูุฑูู ุงูุชุณูุณูู [serial]
   - ุฑูู ุงูุทุงููุฉ [table_no]
   - QR Code
   - ุฃู ุญููู ูู Excel (custom_data)
โ
3. ุชุฎุตูุต ูู ุนูุตุฑ:
   - ุงููููุน (X, Y)
   - ุญุฌู ุงูุฎุท
   - ุงูููู
   - ููุน ุงูุฎุท (Amiri, Kufi, Cairo)
โ
4. ุญูุธ ุงูุชุตููู โ config (layers + canvasSize)
5. ุชูููุฏ ุฌูุงุนู:
   - ููู ุถูู:
     * ุฑุณู ุงูุตูุฑุฉ ุงูุฃุณุงุณูุฉ
     * ููุก ุงูุญููู ุงูุฏููุงููููุฉ ูู custom_data
     * ุฑุณู QR Code ุจูููุฉ qr_payload
     * ุญูุธ ูู JPEG
   - ุชุญููู ZIP ูุญุชูู ุนูู ุฌููุน ุงูุฏุนูุงุช
```

### 4๏ธโฃ **ูุณุญ ุงูุจุงุฑููุฏ (Scanner)**
```
ุตูุญุฉ: Scanner.tsx (ุชุทุจูู PWA ููููุจุงูู)
โ
ููุชุจุฉ: html5-qrcode
- ุงุณุชุฎุฏุงู ูุงููุฑุง ุงููุงุชู
- ูู ุชุดููุฑ QR Code
โ
ุงูู QR Code ูุญุชูู ุนูู: UUID ูุฑูุฏ (qr_payload)
โ
ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
SELECT * FROM guests 
WHERE qr_payload = 'scanned_uuid' 
OR id = 'scanned_uuid'
โ
ุงูุชุญูู ูู ุงูุญุงูุฉ:
1. ุฅุฐุง ูู ููุนุซุฑ ุนููู โ โ ุชุฐูุฑุฉ ุบูุฑ ุตุงูุญุฉ
2. ุฅุฐุง status = 'attended' โ โ๏ธ ุชู ุงููุณุญ ูู ูุจู (duplicate)
   - ุชุณุฌูู ูู: scans table (scan_result: 'duplicate')
3. ุฅุฐุง status = 'pending' โ โ ุตุงูุญ ูููุจูู
   - ุชุญุฏูุซ: status โ 'attended'
   - ุชุณุฌูู ูู: scans table (scan_result: 'success')
โ
ุนุฑุถ ุงููุชูุฌุฉ ุนูู ุงูุดุงุดุฉ:
- ุงุณู ุงูุถูู
- ุฑูู ุงูุทุงููุฉ
- ุงูุญุงูุฉ (ูุจูู / ุฑูุถ / ุชุญุฐูุฑ)
```

### 5๏ธโฃ **ููุญุฉ ุชุญูู ุงูุนููู**
```
ุตูุญุฉ: ClientDashboard.tsx
โ
ุนุฑุถ ุฅุญุตุงุฆูุงุช ุงูุญุฏุซ:
- ุฅุฌูุงูู ุงูุถููู
- ุนุฏุฏ ุงูุญุถูุฑ (attended)
- ูุญุงููุงุช ุงููุณุญ ุงูููุฑุฑุฉ
- ูุณุจุฉ ุงูุญุถูุฑ
โ
ูุตุฏุฑ ุงูุจูุงูุงุช:
- guests table โ COUNT(*)
- scans table โ WHERE scan_result = 'duplicate'
```

---

## ๐ค ุชูุงูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู (Gemini AI)

### ๐ **ุฃูู ููุณุชุฎุฏู AIุ**

#### 1. **ุชุญููู ููู Excel (analyzeGuestList)**
```typescript
// ูู: src/lib/gemini.ts
export async function analyzeGuestList(headers: string[]): Promise<ColumnMapping>

ุงูุงุณุชุฎุฏุงู:
- ูุฑุงุกุฉ ุฃุณูุงุก ุงูุฃุนูุฏุฉ ูู Excel
- ุชุญุฏูุฏ ุฃู ุนููุฏ ูุญุชูู ุนูู:
  * ุงุณู ุงูุถูู โ nameColumn
  * ุฑูู ุงููุงุชู โ phoneColumn  
  * ุฑูู ุงูุทุงููุฉ โ tableColumn
- ุฅุฑุฌุงุน ุงูุงูุชุฑุงุญุงุช ุชููุงุฆูุงู

ูุซุงู:
const mapping = await analyzeGuestList(['ุงูุงุณู', 'ุฌูุงู', 'ุทุงููุฉ ุฑูู']);
// ูุชูุฌุฉ: { nameColumn: 0, phoneColumn: 1, tableColumn: 2 }
```

#### 2. **ุชูููุฏ ูุต ุงูุฏุนูุฉ (generateInvitationText)**
```typescript
export async function generateInvitationText(eventDetails: any): Promise<string>

ุงูุงุณุชุฎุฏุงู:
- ูุชุงุจุฉ ูุต ุฏุนูุฉ ุฃููู ุจุงูุนุฑุจูุฉ
- ุจูุงุกู ุนูู ุชูุงุตูู ุงูุญุฏุซ
- ุงุณุชุฎุฏุงู ุฃุณููุจ ุฑุณูู ูููุฐุจ
```

### โ๏ธ **ุญุณุจ ุทูุจู ุงูุณุงุจู:**
> "ุฅุฒุงูุฉ AI ูู ุฌุงูุจ ุงูุนููู - ููุท ูู Card Factory"

โ **AI ูุญุตูุฑ ูู:**
- ูุนุงูุฌุฉ ุงูุจูุงูุงุช (UploadGuests)
- ุงุณุชูุฏูู ุงูุชุตููู (GenerateInvitations)

โ **ูุง ููุฌุฏ AI ูู:**
- Scanner (ูุงุณุญ ุงูุถููู)
- ClientDashboard (ููุญุฉ ุงูุนููู)

---

## ๐ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### **events** (ุงูุฃุญุฏุงุซ)
```sql
- id: UUID (primary key)
- name: TEXT
- date: DATE
- location: TEXT
- scan_config: JSONB  -- ุฅุนุฏุงุฏุงุช ุนุฑุถ ุงููุงุณุญ ุงูุถูุฆู
```

### **guests** (ุงูุถููู)
```sql
- id: UUID (primary key)
- event_id: UUID (foreign key โ events.id)
- name: TEXT
- phone: TEXT
- serial: TEXT (ุฑูู ุชุณูุณูู ูุฑูุฏ)
- qr_payload: TEXT (ูุญุชูู ุงูุจุงุฑููุฏ - UUID)
- table_no: TEXT
- status: TEXT ('pending' | 'attended' | 'cancelled')
- custom_data: JSONB  -- ๐ฅ ุฌููุน ุงูุฃุนูุฏุฉ ูู Excel
- rsvp_status: TEXT
```

### **scans** (ุณุฌู ุงููุณุญ)
```sql
- id: UUID (primary key)
- event_id: UUID
- guest_id: UUID
- scanned_at: TIMESTAMP (default: now())
- source: TEXT ('inspector_app' | 'web')
- scan_result: TEXT ('success' | 'duplicate' | 'invalid')
```

---

## ๐ ููู ูุนูู QR Codeุ

### **1. ุงูุชูููุฏ (ูู GenerateInvitations)**
```javascript
// ุนูุฏ ุฑูุน ุงูุถูููุ ูููุดุฃ qr_payload ูุฑูุฏ
const qrPayload = crypto.randomUUID(); // ูุซุงู: '550e8400-e29b-41d4-a716-446655440000'

// ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
INSERT INTO guests (qr_payload, name, ...) 
VALUES ('550e8400-...', 'ุฃุญูุฏ ูุญูุฏ', ...)

// ุนูุฏ ุงูุชูููุฏ ุนูู Canvas
<QRCode value={qrPayload} />
// ููุชุฌ ุจุงุฑููุฏ ูุญุชูู ุนูู: 550e8400-e29b-41d4-a716-446655440000
```

### **2. ุงููุณุญ (ูู Scanner)**
```javascript
// ุงููุณุญ ุจุงููุงููุฑุง
const Html5QrcodeScanner = new Html5QrcodeScanner("reader", {...});

// ุนูุฏ ูุณุญ ูุงุฌุญ:
onScanSuccess(decodedText) {
  // decodedText = '550e8400-e29b-41d4-a716-446655440000'
  
  // ุงูุจุญุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  const guest = await supabase
    .from('guests')
    .select('*')
    .or(`qr_payload.eq.${decodedText},id.eq.${decodedText}`)
    .single();
    
  // ุงูุชุญูู ูุงูุชุญุฏูุซ
  if (guest.status === 'pending') {
    // โ ูุจูู
    await supabase
      .from('guests')
      .update({ status: 'attended' })
      .eq('id', guest.id);
  } else if (guest.status === 'attended') {
    // โ๏ธ ููุฑุฑ
    await supabase
      .from('scans')
      .insert({ 
        guest_id: guest.id,
        scan_result: 'duplicate'
      });
  }
}
```

---

## ๐ฑ ุชุซุจูุช ุชุทุจูู ุงูููุจุงูู (PWA)

### **ุนูู Android:**
1. ุงูุชุญ ุงููููุน ูู Chrome
2. ุงุถุบุท ุนูู ุงููุงุฆูุฉ (โฎ)
3. ุงุฎุชุฑ "ุฅุถุงูุฉ ุฅูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ"
4. ุชู! ุงูุขู ุงูุชุทุจูู ูุนูู ุจุฏูู ุฅูุชุฑูุช (offline)

### **ุนูู iOS (iPhone):**
1. ุงูุชุญ ุงููููุน ูู Safari
2. ุงุถุบุท ุนูู ุฒุฑ ุงููุดุงุฑูุฉ (โกโ)
3. ุงุฎุชุฑ "ุฅุถุงูุฉ ุฅูู ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ"
4. ุชู!

### **ุงููููุฒุงุช:**
- โ ุนูู ุจุฏูู ุฅูุชุฑูุช (ุจุนุฏ ุงูุชุญููู ุงูุฃูู)
- โ ูุตูู ูุจุงุดุฑ ูููุงููุฑุง
- โ ุฅุดุนุงุฑุงุช
- โ ูุจุฏู ูุชุทุจูู ุฃุตูู

---

## ๐ ุฑุจุท ุงูุตูุญุงุช ุจุจุนุถูุง

### **ูุณุงุฑ ุงูุชููู:**
```
1. Dashboard (/)
   โ
2. EventManager (/events) โ ุฅูุดุงุก ุญุฏุซ
   โ
3. UploadGuests (/upload-guests) โ ุฑูุน Excel
   โ
4. GenerateInvitations (/generate) โ ุชุตููู ูุชูููุฏ
   โ
5. ุชูุฒูุน ุงูุฏุนูุงุช (ุฎุงุฑุฌ ุงููุธุงู)
   โ
6. Scanner (/scanner) โ ูุณุญ ุนูุฏ ุงูุฏุฎูู
   โ
7. ClientDashboard (/client/:eventId) โ ูุชุงุจุนุฉ ุงูุฅุญุตุงุฆูุงุช
```

### **ูุดุงุฑูุฉ ุงูุจูุงูุงุช:**
```javascript
// ุฌููุน ุงูุตูุญุงุช ุชุณุชุฎุฏู:
import { supabase } from '../lib/supabaseClient';

// ููุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช
// ููุณ ุงูู event_id
// ููุณ ุงูู guest records
```

---

## ๐ ุฃูุงูุฑ ุงูุชุดุบูู

```bash
# ุงูุชุซุจูุช
npm install

# ุชุทููุฑ (Dev Mode)
npm run dev

# ุจูุงุก (Production)
npm run build

# ูุนุงููุฉ ุงูุจูุงุก
npm run preview

# ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช
node scripts/setup-db.js
```

---

## ๐ ููุงุญุธุงุช ูููุฉ

### โ **ูุง ุชู ุฅูุฌุงุฒู:**
1. ูุธุงู ูุงูู ูุฅุฏุงุฑุฉ ุงูุฃุญุฏุงุซ
2. ุฑูุน ูุชุญููู Excel ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู
3. ุงุณุชูุฏูู ุชุตููู ุฏููุงูููู ูุน ูุนุงููุฉ
4. ุชูููุฏ ุฌูุงุนู ููุฏุนูุงุช (Batch Generation)
5. ูุงุณุญ QR Code ูุชูุฏู ูุน ูุดู ุงูุชูุฑุงุฑ
6. ููุญุฉ ุชุญูู ุจุงูุฅุญุตุงุฆูุงุช
7. ุฏุนู PWA ููููุจุงูู
8. ุฏุนู ูุงูู ููุนุฑุจูุฉ (RTL)

### ๐ **ุชุญุณููุงุช ููุชุฑุญุฉ:**
1. ุฅุถุงูุฉ service worker ููุนูู offline
2. ูุงุฌูุฉ ุฅุนุฏุงุฏุงุช scan_config ููุนููู
3. AI Layout Assistant (ุงูุชุฑุงุญุงุช ุงูุชุตููู)
4. ุชุตุฏูุฑ ุชูุงุฑูุฑ PDF
5. ูุธุงู ุฅุดุนุงุฑุงุช realtime

---

## ๐จ ูุซุงู: ุณููุงุฑูู ูุงูู

```
1. ุงูููุธู ูููุดุฆ ุญุฏุซ "ุญูู ุฒูุงู ุฃุญูุฏ ููุงุทูุฉ"
2. ูุฑูุน ููู Excel ุจู 500 ุถูู
3. AI ูุญูู ุงูุฃุนูุฏุฉ ููุทุงุจููุง ุชููุงุฆูุงู
4. ูุฑูุน ุชุตููู ุงูุฏุนูุฉ ุงููุงุฑุบ
5. ูุถุน ุนูุงุตุฑ: [ุงุณู ุงูุถูู] + [ุฑูู ุงูุทุงููุฉ] + QR Code
6. ูุถุบุท "ุชูููุฏ" โ ูุญุตู ุนูู 500 ุฏุนูุฉ ูู ZIP
7. ูุทุจุน ูููุฒุน ุงูุฏุนูุงุช
8. ููู ุงูุญูู: ููุธู ุงูุงุณุชูุจุงู ููุชุญ /scanner ุนูู ุฌูุงูู
9. ููุณุญ ูู ุฏุนูุฉ ุนูุฏ ุงูุฏุฎูู
10. ุงููุธุงู ูุณุฌู ุงูุญุถูุฑ ุชููุงุฆูุงู
11. ุงูุนููู ููุชุญ /client/event-id ููุชุงุจุนุฉ ุงูุฅุญุตุงุฆูุงุช live
```

---

## ๐ ูุดุงูู ุดุงุฆุนุฉ ูุญููููุง

### ุงููุดููุฉ: ุงููุงููุฑุง ูุง ุชุนูู
**ุงูุญู:** ุงูุชุฃูุฏ ูู:
- ุงุณุชุฎุฏุงู HTTPS (ุฃู localhost)
- ุฅุนุทุงุก ุฅุฐู ุงููุงููุฑุง ูููุชุตูุญ
- ุงุณุชุฎุฏุงู ูุชุตูุญ ุญุฏูุซ (Chrome, Safari)

### ุงููุดููุฉ: QR Code ูุง ูููุฑุฃ
**ุงูุญู:**
- ุชุฃูุฏ ูู ุฌูุฏุฉ ุงูุทุจุงุนุฉ
- ุงุณุชุฎุฏู ุญุฌู QR ููุงุณุจ (150px ุนูู ุงูุฃูู)
- ุงุฎุชุจุฑ ุชุจุงูู ุงูุฃููุงู (ุฃุณูุฏ ุนูู ุฃุจูุถ)

### ุงููุดููุฉ: ุงูุจูุงูุงุช ูุง ุชุธูุฑ
**ุงูุญู:**
- ุงูุญุต console.log
- ุชุฃูุฏ ูู Supabase URL ูุงูููุชุงุญ
- ุฑุงุฌุน ุฌุฏูู permissions (RLS)

---

**ุชู ุงูุชูุซูู ุจูุงุณุทุฉ: Antigravity AI ๐**
**ุขุฎุฑ ุชุญุฏูุซ: 2025-12-02**
